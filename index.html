<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Visitor Appointment System</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
    h2 { color: #333; }
    form, .admin, .status-check {
      background: #fff; padding: 20px; margin: 20px 0; border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    input, select, textarea {
      width: 100%; padding: 8px; margin: 8px 0; border: 1px solid #ccc; border-radius: 4px;
    }
    button {
      background: #007BFF; color: #fff; padding: 10px 15px;
      border: none; border-radius: 4px; cursor: pointer;
    }
    button:hover { background: #0056b3; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    table, th, td { border: 1px solid #ddd; }
    th, td { padding: 8px; text-align: left; }
  </style>
</head>
<body>

  <h2>Visitor Appointment Form</h2>
  <form id="visitorForm">
    <input type="text" name="name" placeholder="Full Name" required>
    <input type="text" name="address" placeholder="Address" required>
    <input type="text" name="country" placeholder="Country" required>
    <input type="date" name="dob" required>
    <input type="date" name="date" required>
    <input type="time" name="time" required>
    <input type="text" name="contact" placeholder="Contact Number" required>
    <textarea name="purpose" placeholder="Purpose of Visit" required></textarea>
    <input type="email" name="email" placeholder="Email" required>
    <button type="submit">Submit</button>
  </form>

  <div id="formMessage"></div>

  <div class="status-check">
    <h2>Check Appointment Status</h2>
    <input type="text" id="apptNo" placeholder="Enter Appointment No">
    <button onclick="checkStatus()">Check Status</button>
    <div id="statusResult"></div>
  </div>

  <div class="admin">
    <h2>Admin Login</h2>
    <input type="text" id="adminUser" placeholder="Username">
    <input type="password" id="adminPass" placeholder="Password">
    <button onclick="adminLogin()">Login</button>
    <div id="adminSection" style="display:none;">
      <h3>Visitor Records</h3>
      <table id="visitorTable">
        <thead>
          <tr>
            <th>Appt No</th><th>Name</th><th>Date</th><th>Time</th>
            <th>Contact</th><th>Email</th><th>Status</th><th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxY8lDl3BXUtY3_kuRT-rC4JbRJvPQU5pusYgU-xCPb0JKgkspEVSWojq79PXnhxy8QNA/exec";

// ---- Submit visitor form ----
document.getElementById("visitorForm").addEventListener("submit", e => {
  e.preventDefault();
  const formData = Object.fromEntries(new FormData(e.target).entries());
  fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify(formData),
    headers: { "Content-Type": "application/json" }
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      document.getElementById("formMessage").innerText =
        "✅ Appointment submitted. Your No: " + data.appointmentNo;
      e.target.reset();
    } else {
      document.getElementById("formMessage").innerText = "❌ " + data.error;
    }
  })
  .catch(() => {
    document.getElementById("formMessage").innerText = "❌ Failed to submit.";
  });
});

// ---- Check appointment status ----
function checkStatus() {
  const apptNo = document.getElementById("apptNo").value;
  fetch(`${WEB_APP_URL}?action=status&apptNo=${encodeURIComponent(apptNo)}`)
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      document.getElementById("statusResult").innerText =
        "Status: " + data.record.Status;
    } else {
      document.getElementById("statusResult").innerText = "❌ " + data.error;
    }
  })
  .catch(() => {
    document.getElementById("statusResult").innerText = "❌ Failed to fetch.";
  });
}

// ---- Admin login ----
function adminLogin() {
  const u = document.getElementById("adminUser").value;
  const p = document.getElementById("adminPass").value;
  if (u === "admin" && p === "admin") {
    document.getElementById("adminSection").style.display = "block";
    loadVisitors();
  } else {
    alert("Invalid credentials");
  }
}

// ---- Load all visitors ----
function loadVisitors() {
  fetch(`${WEB_APP_URL}?action=all`)
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      const tbody = document.querySelector("#visitorTable tbody");
      tbody.innerHTML = "";
      data.data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.AppointmentNo}</td>
          <td>${row.Name}</td>
          <td>${row.Date}</td>
          <td>${row.Time}</td>
          <td>${row.Contact}</td>
          <td>${row.Email}</td>
          <td>${row.Status}</td>
          <td>
            <button onclick="updateStatus('${row.AppointmentNo}','Accepted')">Accept</button>
            <button onclick="updateStatus('${row.AppointmentNo}','Rejected')">Reject</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }
  });
}

// ---- Update visitor status ----
function updateStatus(apptNo, status) {
  fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify({ appointmentNo: apptNo, status: status }),
    headers: { "Content-Type": "application/json" }
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) loadVisitors();
    else alert("Error: " + data.error);
  });
}
</script>

</body>
</html>
