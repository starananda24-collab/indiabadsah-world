<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visitor Appointments</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h2 { margin-top: 30px; }
  form { max-width: 500px; margin-bottom: 40px; }
  label { display: block; margin-top: 10px; }
  input, select { width: 100%; padding: 8px; margin-top: 4px; }
  button { margin-top: 10px; padding: 10px 15px; cursor: pointer; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background-color: #f2f2f2; }
  .status-Pending { background-color: pink; }
  .status-Accepted { background-color: lightgreen; }
  .status-Rejected { background-color: red; color: white; }
</style>
</head>
<body>

<h1>Visitor Appointments</h1>

<h2>Submit Appointment</h2>
<form id="visitorForm">
  <label>Name:<input type="text" id="name" required></label>
  <label>Address:<input type="text" id="address" required></label>
  <label>Country:<input type="text" id="country" required></label>
  <label>Date of Birth:<input type="date" id="dob" required></label>
  <label>Visit Date:<input type="date" id="date" required></label>
  <label>Visit Time:<input type="time" id="time" required></label>
  <label>Contact:<input type="text" id="contact" required></label>
  <label>Purpose:<input type="text" id="purpose" required></label>
  <label>Email:<input type="email" id="email" required></label>
  <button type="submit">Submit</button>
</form>

<h2>Admin Panel</h2>
<table id="adminTable">
  <thead>
    <tr>
      <th>Appointment No</th>
      <th>Name</th>
      <th>Address</th>
      <th>Country</th>
      <th>DOB</th>
      <th>Date</th>
      <th>Time</th>
      <th>Contact</th>
      <th>Purpose</th>
      <th>Email</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyU-aycefMRE9htioaZ5RrTFMus7n89PNl6NiXwRmeSuitwiePk0qxsuCQkwLKKTI6i/exec";

// ---- Visitor Form Submission ----
document.getElementById("visitorForm").addEventListener("submit", function(e){
  e.preventDefault();
  const formData = {
    name: document.getElementById("name").value,
    address: document.getElementById("address").value,
    country: document.getElementById("country").value,
    dob: document.getElementById("dob").value,
    date: document.getElementById("date").value,
    time: document.getElementById("time").value,
    contact: document.getElementById("contact").value,
    purpose: document.getElementById("purpose").value,
    email: document.getElementById("email").value
  };
  fetch(WEB_APP_URL, {
    method: 'POST',
    body: JSON.stringify(formData)
  })
  .then(res => res.json())
  .then(data => {
    if(data.success){
      alert("Appointment submitted: " + data.appointmentNo);
      document.getElementById("visitorForm").reset();
      loadAdminTable();
    } else {
      alert("Error: " + data.error);
    }
  })
  .catch(err => alert("Failed to submit form: " + err));
});

// ---- Load Admin Table ----
function loadAdminTable(){
  fetch(WEB_APP_URL + "?action=all")
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#adminTable tbody");
      tbody.innerHTML = "";
      if(data.success){
        data.data.forEach(row => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${row["Appointment No"]}</td>
            <td>${row["Name"]}</td>
            <td>${row["Address"]}</td>
            <td>${row["Country"]}</td>
            <td>${row["DOB"]}</td>
            <td>${row["Date"]}</td>
            <td>${row["Time"]}</td>
            <td>${row["Contact"]}</td>
            <td>${row["Purpose"]}</td>
            <td>${row["Email"]}</td>
            <td class="status-${row["Status"]}">${row["Status"]}</td>
            <td>
              <button onclick="updateStatus('${row['Appointment No']}','Accepted')">Accept</button>
              <button onclick="updateStatus('${row['Appointment No']}','Rejected')">Reject</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }
    });
}

// ---- Update Status ----
function updateStatus(apptNo, status){
  fetch(WEB_APP_URL, {
    method: 'POST',
    body: JSON.stringify({ appointmentNo: apptNo, status: status })
  })
  .then(res => res.json())
  .then(data => {
    if(data.success){
      alert("Status updated: " + status);
      loadAdminTable();
    } else {
      alert("Error: " + data.error);
    }
  })
  .catch(err => alert("Failed to update status: " + err));
}

// ---- Initial Load ----
loadAdminTable();
</script>

</body>
</html>
