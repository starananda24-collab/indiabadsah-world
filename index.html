<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Visitor Appointment</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f7fa; margin: 0; padding: 0; }
    header { background: linear-gradient(90deg,#0062E6,#33AEFF); padding: 20px; color: white; text-align: center; }
    main { max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h2 { color: #0062E6; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; }
    button { margin-top: 15px; padding: 10px 20px; border: none; border-radius: 5px; background: #0062E6; color: white; cursor: pointer; }
    button:hover { background: #004bb5; }
    #whatsappButton { display: none; margin-top: 15px; background: #25D366; }
    #adminDashboard { display: none; margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 8px; text-align: left; }
  </style>
</head>
<body>
  <header>
    <h1>Visitor Appointment System</h1>
  </header>

  <main>
    <!-- Visitor Form -->
    <section>
      <h2>Book an Appointment</h2>
      <form id="formVisitor">
        <label>Visitor Name</label>
        <input type="text" id="visitorName" required>

        <label>Visitor DOB</label>
        <input type="date" id="visitorDOB" required>

        <label>Father Name</label>
        <input type="text" id="fatherName" required>

        <label>Visitor Address</label>
        <input type="text" id="visitorAddress" required>

        <label>Country</label>
        <input type="text" id="country" required>

        <label>Visit Date</label>
        <input type="date" id="visitDate" required>

        <label>Visit Time</label>
        <input type="time" id="visitTime" required>

        <label>Contact Number</label>
        <input type="text" id="contactNumber" required>

        <label>Passport Number</label>
        <input type="text" id="passportNumber" required>

        <label>Email</label>
        <input type="email" id="email" required>

        <button type="submit">Submit Appointment</button>
      </form>

      <a id="whatsappButton" target="_blank">Send via WhatsApp</a>
    </section>

    <!-- Admin Login -->
    <section>
      <h2>Admin Login</h2>
      <form id="formAdmin">
        <label>Username</label>
        <input type="text" id="adminUsername" required>

        <label>Password</label>
        <input type="password" id="adminPassword" required>

        <button type="submit">Login</button>
      </form>
    </section>

    <!-- Admin Dashboard -->
    <section id="adminDashboard">
      <h2>Visitor Details</h2>
      <table>
        <thead>
          <tr>
            <th>Appointment No</th>
            <th>Visitor Name</th>
            <th>DOB</th>
            <th>Father Name</th>
            <th>Address</th>
            <th>Country</th>
            <th>Visit Date</th>
            <th>Visit Time</th>
            <th>Contact</th>
            <th>Passport</th>
            <th>Email</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="visitorTableBody"></tbody>
      </table>
    </section>
  </main>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzrfjaonySDdP_7sAaXF8f6jz7de5gliHu7xwZWXgffRMZflcA3qz4EcWBWXV0y_n-bGg/exec";

    // Submit Visitor Form
    document.getElementById("formVisitor").addEventListener("submit", function(e) {
      e.preventDefault();
      const appointmentNo = "APPT-" + Date.now();
      const data = {
        visitorName: document.getElementById("visitorName").value,
        visitorDOB: document.getElementById("visitorDOB").value,
        fatherName: document.getElementById("fatherName").value,
        visitorAddress: document.getElementById("visitorAddress").value,
        country: document.getElementById("country").value,
        visitDate: document.getElementById("visitDate").value,
        visitTime: document.getElementById("visitTime").value,
        contactNumber: document.getElementById("contactNumber").value,
        passportNumber: document.getElementById("passportNumber").value,
        email: document.getElementById("email").value,
        appointmentNo: appointmentNo,
        status: "Pending"
      };

      fetch(WEB_APP_URL, {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.json())
      .then(res => {
        if (res.success) {
          alert("Appointment submitted successfully!\nYour Appointment No: " + appointmentNo);
          document.getElementById("formVisitor").reset();
          const waLink = `https://wa.me/971506309833?text=${encodeURIComponent(
            `New Visitor Appointment:\nAppointment No: ${appointmentNo}\nName: ${data.visitorName}\nContact: ${data.contactNumber}\nVisit Date: ${data.visitDate} ${data.visitTime}`
          )}`;
          const waBtn = document.getElementById("whatsappButton");
          waBtn.href = waLink;
          waBtn.style.display = "inline-block";
        } else {
          alert("Error: " + res.message);
        }
      })
      .catch(err => alert("Failed to fetch: " + err.message));
    });

    // Admin Login
    document.getElementById("formAdmin").addEventListener("submit", function(e) {
      e.preventDefault();
      const user = document.getElementById("adminUsername").value;
      const pass = document.getElementById("adminPassword").value;
      if (user === "admin1" && pass === "Password123") {
        alert("Login Successful");
        document.getElementById("formAdmin").style.display = "none";
        document.getElementById("adminDashboard").style.display = "block";
        loadVisitors();
      } else {
        alert("Access Denied");
      }
    });

    // Load Visitors in Admin Dashboard
    function loadVisitors() {
      fetch(WEB_APP_URL)
        .then(res => res.json())
        .then(data => {
          const tbody = document.getElementById("visitorTableBody");
          tbody.innerHTML = "";
          data.forEach(row => {
            const tr = document.createElement("tr");
            row.forEach(cell => {
              const td = document.createElement("td");
              td.textContent = cell;
              tr.appendChild(td);
            });
            tbody.appendChild(tr);
          });
        });
    }
  </script>
</body>
</html>
