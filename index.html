<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>starananda24-collab-github Website</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f9f9f9; }
    header { background:#333; color:#fff; padding:12px; text-align:center; }
    nav a { color:#fff; margin:0 12px; text-decoration:none; }
    main { padding:20px; }
    section { margin-bottom:40px; }
    #dynamicForm, #adminDashboard, #logoutBtn { display:none; }
    table { width:100%; border-collapse:collapse; }
    th, td { border:1px solid #ccc; padding:8px; text-align:left; }
    th { background:#eee; }
    .status-pending { color:orange; font-weight:bold; }
    .status-accepted { color:green; font-weight:bold; }
    .status-rejected { color:red; font-weight:bold; }
    .action-btn { margin:2px; padding:5px 8px; cursor:pointer; }
  </style>
</head>
<body>
  <header>
    <h1>starananda24-collab-github Website</h1>
    <nav>
      <a href="#" id="visitorLink">Visitor Form</a>
      <a href="#about">About Me</a>
      <a href="#admin">Admin</a>
    </nav>
  </header>

  <main>
    <section id="about">
      <h2>About Me</h2>
      <button onclick="toggleAbout('personal')">Personal Info</button>
      <button onclick="toggleAbout('professional')">Professional Info</button>
      <div id="personal" style="display:none;"><p>Personal info here.</p></div>
      <div id="professional" style="display:none;"><p>Professional info here.</p></div>
    </section>

    <!-- Visitor Form -->
    <section id="dynamicForm">
      <h2>Visitor Appointment Form</h2>
      <form id="formVisitor">
        <input type="text" id="visitorName" placeholder="Visitor Name" required><br><br>
        <input type="text" id="fatherName" placeholder="Father Name" required><br><br>
        <input type="date" id="dob" placeholder="Date of Birth" required><br><br>
        <input type="text" id="address" placeholder="Visitor Address" required><br><br>
        <input type="text" id="country" placeholder="Country" required><br><br>
        <input type="date" id="visitDate" required><br><br>
        <input type="time" id="visitTime" required><br><br>
        <input type="text" id="contactNumber" placeholder="Contact Number" required><br><br>
        <input type="text" id="passport" placeholder="Passport Number"><br><br>
        <input type="email" id="email" placeholder="Email"><br><br>
        <button type="submit">Submit Appointment</button>
        <button type="button" id="cancelFormBtn">Cancel</button>
      </form>
    </section>

    <!-- Admin Section -->
    <section id="admin">
      <h2>Admin Login</h2>
      <form id="formAdmin">
        <input type="text" id="adminUsername" placeholder="Username" required><br><br>
        <input type="password" id="adminPassword" placeholder="Password" required><br><br>
        <button type="submit">Login</button>
      </form>
      <button id="logoutBtn" onclick="logoutAdmin()">Logout</button>
      <div id="adminDashboard">
        <h3>Visitor Appointments</h3>
        <input type="text" id="searchVisitor" placeholder="Search Visitors"><br><br>
        <table id="visitorTable">
          <thead>
            <tr>
              <th>Name</th><th>DOB</th><th>Father</th><th>Address</th><th>Country</th>
              <th>Visit Date</th><th>Visit Time</th><th>Contact</th><th>Passport</th><th>Email</th><th>Appt No</th><th>Status</th><th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbySBQDAmdNIc5EFvz4lnSArBk7lxiPzkhFZgGs3EYWZ6p4swlNAYuiSs4cuafvMPgtH8Q/exec";
  const ADMIN_WHATSAPP = "971506309833"; // change to your WhatsApp number
  const ADMIN_USER = "admin";
  const ADMIN_PASS = "admin";

  document.getElementById('visitorLink').addEventListener('click',()=>{document.getElementById('dynamicForm').style.display='block';});
  document.getElementById('cancelFormBtn').addEventListener('click',()=>{document.getElementById('dynamicForm').style.display='none';});
  function toggleAbout(id){ const el = document.getElementById(id); el.style.display = (el.style.display==='block')?'none':'block'; }

  // Visitor form submission
  document.getElementById('formVisitor').addEventListener('submit', async function(e){
    e.preventDefault();
    const visitorName = document.getElementById('visitorName').value.trim();
    const fatherName = document.getElementById('fatherName').value.trim();
    const dob = document.getElementById('dob').value;
    const address = document.getElementById('address').value.trim();
    const country = document.getElementById('country').value;
    const visitDate = document.getElementById('visitDate').value;
    const visitTime = document.getElementById('visitTime').value;
    const contactNumber = document.getElementById('contactNumber').value.trim();
    const passport = document.getElementById('passport').value.trim();
    const email = document.getElementById('email').value.trim();

    const payload = {
      visitorName, "Visitor Name": visitorName,
      fatherName, "Father Name": fatherName,
      dob, "Visitor DOB": dob,
      address, "Visitor Address": address,
      country, "Country": country,
      visitDate, "Visit Date": visitDate,
      visitTime, "Visit Time": visitTime,
      contactNumber, "Contact Number": contactNumber,
      passport, "Passport Number": passport,
      email, "Email": email
    };

    try {
      const resp = await fetch(WEB_APP_URL, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      const result = await resp.json();
      if(!result.success){ alert('Error: '+(result.error||'Unknown')); return; }

      const apptNo = result.appointmentNumber;
      const issuedAt = result.timestamp || new Date().toLocaleString();

      // Print slip
      const slipHtml = `
        <html><head><title>Appointment Slip</title>
        <style>
        body{font-family:Arial;padding:20px;}
        .slip{border:2px solid #000;padding:20px;max-width:700px;margin:auto;}
        h2{text-align:center;}
        table{width:100%;border-collapse:collapse;margin-top:10px;}
        td{border:1px solid #ccc;padding:6px;}
        td.label{font-weight:bold;width:30%;background:#f5f5f5;}
        </style></head><body>
        <div class="slip">
          <h2>Official Appointment Slip</h2>
          <p><b>Issued:</b> ${issuedAt}</p>
          <table>
            <tr><td class="label">Appointment No</td><td>${apptNo}</td></tr>
            <tr><td class="label">Visitor Name</td><td>${visitorName}</td></tr>
            <tr><td class="label">Father Name</td><td>${fatherName}</td></tr>
            <tr><td class="label">DOB</td><td>${dob}</td></tr>
            <tr><td class="label">Address</td><td>${address}</td></tr>
            <tr><td class="label">Country</td><td>${country}</td></tr>
            <tr><td class="label">Visit Date</td><td>${visitDate}</td></tr>
            <tr><td class="label">Visit Time</td><td>${visitTime}</td></tr>
            <tr><td class="label">Contact</td><td>${contactNumber}</td></tr>
            <tr><td class="label">Passport</td><td>${passport}</td></tr>
            <tr><td class="label">Email</td><td>${email}</td></tr>
          </table>
          <p style="margin-top:10px;">Please bring this slip and valid ID.</p>
        </div>
        <script>window.print();<\/script>
        </body></html>
      `;
      const printWin = window.open('', '_blank', 'width=800,height=600');
      printWin.document.write(slipHtml);
      printWin.document.close();

      // WhatsApp notify
      const waText = `New Appointment\nNo: ${apptNo}\nIssued: ${issuedAt}\nVisitor: ${visitorName}\nFather: ${fatherName}\nDOB: ${dob}\nVisit: ${visitDate} ${visitTime}\nContact: ${contactNumber}\nPassport: ${passport}\nEmail: ${email}\nAddress: ${address}`;
      window.open('https://wa.me/'+ADMIN_WHATSAPP+'?text='+encodeURIComponent(waText),'_blank');

      alert('Appointment submitted successfully. No: '+apptNo);
      document.getElementById('formVisitor').reset();
      document.getElementById('dynamicForm').style.display='none';
    } catch(err){ alert('Error sending appointment: '+err.message); }
  });

  // Admin login
  document.getElementById('formAdmin').addEventListener('submit',function(e){
    e.preventDefault();
    const user=document.getElementById('adminUsername').value;
    const pass=document.getElementById('adminPassword').value;
    if(user===ADMIN_USER && pass===ADMIN_PASS){
      document.getElementById('adminDashboard').style.display='block';
      document.getElementById('logoutBtn').style.display='block';
      loadVisitors();
      alert('Login Successful');
    } else alert('Invalid credentials');
  });
  function logoutAdmin(){document.getElementById('adminDashboard').style.display='none';document.getElementById('logoutBtn').style.display='none';document.getElementById('formAdmin').reset();}

  async function loadVisitors(){
    const tbody=document.querySelector('#visitorTable tbody');
    tbody.innerHTML='';
    try{
      const resp=await fetch(WEB_APP_URL+'?action=getVisitors');
      const data=await resp.json();
      const visitors=data.visitors||[];
      visitors.forEach(v=>{
        const tr=document.createElement('tr');
        const status=v["Status"]||"";
        const cls=status?'status-'+status.toLowerCase():'';
        tr.innerHTML=`
          <td>${v["Visitor Name"]||''}</td>
          <td>${v["Visitor DOB"]||''}</td>
          <td>${v["Father Name"]||''}</td>
          <td>${v["Visitor Address"]||''}</td>
          <td>${v["Country"]||''}</td>
          <td>${v["Visit Date"]||''}</td>
          <td>${v["Visit Time"]||''}</td>
          <td>${v["Contact Number"]||''}</td>
          <td>${v["Passport Number"]||''}</td>
          <td>${v["Email"]||''}</td>
          <td>${v["Appointment Number"]||''}</td>
          <td class="${cls}">${status}</td>
          <td>
            <button class="action-btn" onclick="updateStatus('${v['Appointment Number']}','Accepted')">Accept</button>
            <button class="action-btn" onclick="updateStatus('${v['Appointment Number']}','Rejected')">Reject</button>
            <button class="action-btn" onclick="deleteVisitor('${v['Appointment Number']}')">Delete</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }catch(err){console.error(err);}
  }

  async function updateStatus(appNo,status){
    try{
      const resp=await fetch(WEB_APP_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({appointmentNumber:appNo,status})});
      const result=await resp.json();
      alert(result.message||'Updated');
      loadVisitors();
    }catch(err){alert('Error updating');}
  }
  async function deleteVisitor(appNo){
    if(!confirm("Delete permanently?")) return;
    try{
      const resp=await fetch(WEB_APP_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({appointmentNumber:appNo,delete:true})});
      const result=await resp.json();
      alert(result.message||'Deleted');
      loadVisitors();
    }catch(err){alert('Error deleting');}
  }

  document.getElementById('searchVisitor').addEventListener('keyup',function(){
    const filter=this.value.toLowerCase();
    document.querySelectorAll('#visitorTable tbody tr').forEach(r=>{
      r.style.display=r.innerText.toLowerCase().includes(filter)?'':'none';
    });
  });
  </script>
</body>
</html>
