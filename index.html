<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visitor Appointments - BNB</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f7f7f7; }
  header { background:#0b6efa; color:white; padding:1rem; text-align:center; font-size:1.5rem; font-weight:bold; }
  .container { max-width:900px; margin:2rem auto; padding:1rem; background:white; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
  h2 { color:#0b6efa; }
  input, select, textarea, button { width:100%; padding:0.5rem; margin:0.5rem 0; border-radius:4px; border:1px solid #ccc; }
  button { cursor:pointer; background:#0b6efa; color:white; border:none; }
  table { width:100%; border-collapse:collapse; margin-top:1rem; }
  th, td { border:1px solid #ccc; padding:0.5rem; text-align:left; }
  th { background:#0b6efa; color:white; }
  .status-pending { color:#d9534f; font-weight:bold; }
  .status-accepted { color:#28a745; font-weight:bold; }
  .status-rejected { color:#ff66cc; font-weight:bold; }
</style>
</head>
<body>

<header>BNB Visitor Appointment System</header>

<div class="container">
  <h2>Visitor Submission Form</h2>
  <form id="visitorForm">
    <input type="text" id="name" placeholder="Full Name" required>
    <input type="text" id="address" placeholder="Address" required>
    <input type="text" id="country" placeholder="Country" required>
    <input type="date" id="dob" placeholder="Date of Birth" required>
    <input type="date" id="date" placeholder="Visit Date" required>
    <input type="time" id="time" placeholder="Visit Time" required>
    <input type="text" id="contact" placeholder="Contact Number" required>
    <input type="text" id="purpose" placeholder="Purpose of Visit" required>
    <input type="email" id="email" placeholder="Email" required>
    <button type="submit">Submit Appointment</button>
  </form>
  <p id="formMessage"></p>
</div>

<div class="container">
  <h2>Admin Dashboard</h2>
  <table id="adminTable">
    <thead>
      <tr>
        <th>Appointment No</th>
        <th>Name</th>
        <th>Address</th>
        <th>Country</th>
        <th>DOB</th>
        <th>Date</th>
        <th>Time</th>
        <th>Contact</th>
        <th>Purpose</th>
        <th>Email</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyU-aycefMRE9htioaZ5RrTFMus7n89PNl6NiXwRmeSuitwiePk0qxsuCQkwLKKTI6i/exec";

// Visitor form submit
document.getElementById("visitorForm").addEventListener("submit", async function(e){
  e.preventDefault();
  const data = {
    name: document.getElementById("name").value,
    address: document.getElementById("address").value,
    country: document.getElementById("country").value,
    dob: document.getElementById("dob").value,
    date: document.getElementById("date").value,
    time: document.getElementById("time").value,
    contact: document.getElementById("contact").value,
    purpose: document.getElementById("purpose").value,
    email: document.getElementById("email").value
  };
  try {
    const res = await fetch(WEB_APP_URL, {
      method:"POST",
      body: JSON.stringify(data),
      headers: { "Content-Type":"application/json" }
    });
    const result = await res.json();
    if(result.success){
      document.getElementById("formMessage").innerText = `Appointment submitted! Your No: ${result.appointmentNo}`;
      this.reset();
      loadAdminData();
    } else {
      document.getElementById("formMessage").innerText = "Error: " + result.error;
    }
  } catch(err){
    document.getElementById("formMessage").innerText = "Failed to submit form";
    console.error(err);
  }
});

// Load admin data
async function loadAdminData(){
  try{
    const res = await fetch(WEB_APP_URL + "?action=all");
    const result = await res.json();
    const tbody = document.querySelector("#adminTable tbody");
    tbody.innerHTML = "";
    if(result.success && result.data){
      result.data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row["Appointment No"]}</td>
          <td>${row["Name"]}</td>
          <td>${row["Address"]}</td>
          <td>${row["Country"]}</td>
          <td>${row["DOB"]}</td>
          <td>${row["Date"]}</td>
          <td>${row["Time"]}</td>
          <td>${row["Contact"]}</td>
          <td>${row["Purpose"]}</td>
          <td>${row["Email"]}</td>
          <td class="status-${row.Status.toLowerCase()}">${row.Status}</td>
          <td>
            <button onclick="updateStatus('${row['Appointment No']}','Accepted')">Accept</button>
            <button onclick="updateStatus('${row['Appointment No']}','Rejected')">Reject</button>
            <button onclick="updateStatus('${row['Appointment No']}','Pending')">Pending</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }
  } catch(err){
    console.error(err);
  }
}

// Update status
async function updateStatus(apptNo, status){
  try{
    const res = await fetch(WEB_APP_URL, {
      method:"POST",
      body: JSON.stringify({appointmentNo: apptNo, status: status}),
      headers: {"Content-Type":"application/json"}
    });
    const result = await res.json();
    if(result.success){
      loadAdminData();
    } else {
      alert("Error updating status: "+result.error);
    }
  } catch(err){
    console.error(err);
  }
}

// Initial load
loadAdminData();
</script>
</body>
</html>
