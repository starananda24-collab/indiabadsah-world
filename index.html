<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>E-Appointment System</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
    header { background: #333; color: #fff; padding: 15px; text-align: center; }
    nav { background: #444; padding: 10px; text-align: center; }
    nav a { color: #fff; margin: 0 10px; text-decoration: none; font-weight: bold; }
    section { padding: 20px; }
    .hidden { display: none; }
    .btn { padding: 8px 14px; border: none; cursor: pointer; font-weight: bold; border-radius: 5px; margin: 5px; }
    .btn-green { background: green; color: #fff; }
    .btn-red { background: red; color: #fff; }
    .btn-yellow { background: gold; color: #000; }
    .btn-grey { background: grey; color: #fff; }
    #visitorStatus { margin-top: 20px; padding: 10px; }
    .status-box { padding: 15px; margin-top: 10px; font-size: 18px; font-weight: bold; border-radius: 5px; text-align: center; }
    .accepted { background: green; color: white; }
    .rejected { background: red; color: white; }
    .busy { background: deeppink; color: white; }
    #printSection { display: none; background: white; padding: 20px; border: 2px solid black; }
    #printSection h2 { text-align: center; text-decoration: underline; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    table, th, td { border: 1px solid black; }
    th, td { padding: 8px; text-align: left; }
    footer { background: #000; color: yellow; text-align: center; padding: 15px; margin-top: 20px; }
    footer a { color: yellow; margin: 0 10px; font-size: 20px; text-decoration: none; }
    /* Chat Box */
    .chat-box { border: 1px solid #ccc; padding: 10px; margin-top: 10px; max-width: 400px; background: #fff; }
    .chat-messages { height: 150px; overflow-y: auto; border: 1px solid #ddd; padding: 5px; margin-bottom: 5px; }
    .chat-input { width: 80%; }
  </style>
</head>
<body>
  <header><h1>E-Appointment System</h1></header>
  <nav>
    <a href="#" onclick="showSection('visitorForm')">Visitor Form</a>
    <a href="#" onclick="showSection('adminLogin')">Admin Login</a>
    <a href="#" onclick="showSection('visitorSearch')">Visitor Status</a>
  </nav>

  <!-- Visitor Form -->
  <section id="visitorForm" class="hidden">
    <h2>Visitor Form</h2>
    <form id="visitorFormElement">
      <label>Name: <input type="text" id="vName" required></label><br><br>
      <label>Email: <input type="email" id="vEmail" required></label><br><br>
      <label>Country: <input type="text" id="vCountry" required></label><br><br>
      <label>Country Code: <input type="text" id="vCountryCode" required></label><br><br>
      <label>Date of Birth: <input type="date" id="vDob" required></label><br><br>
      <label>Visit Date: <input type="date" id="vDate" required></label><br><br>
      <label>Visit Time: <input type="time" id="vTime" required></label><br><br>
      <button type="submit" class="btn btn-yellow">Submit</button>
    </form>
  </section>

  <!-- Visitor Search -->
  <section id="visitorSearch" class="hidden">
    <h2>Search Appointment Status</h2>
    <input type="text" id="searchAppNo" placeholder="Enter Appointment Number">
    <button class="btn btn-yellow" onclick="searchStatus()">Search</button>
    <div id="visitorStatus"></div>
  </section>

  <!-- Admin Login -->
  <section id="adminLogin" class="hidden">
    <h2>Admin Login</h2>
    <form id="adminLoginForm">
      <label>Username: <input type="text" id="adminUser" required></label><br><br>
      <label>Password: <input type="password" id="adminPass" required></label><br><br>
      <button type="submit" class="btn btn-yellow">Login</button>
    </form>
  </section>

  <!-- Admin Dashboard -->
  <section id="adminDashboard" class="hidden">
    <h2>Welcome Admin - Bhola Nath Basak</h2>
    <button onclick="logout()" class="btn btn-grey">Logout</button>
    <div id="visitorList"></div>
  </section>

  <!-- Print Layout -->
  <section id="printSection"></section>

  <!-- Footer Social Links -->
  <footer>
    <p>Connect with me:</p>
    <a href="mailto:starananda24@gmail.com">ðŸ“§</a>
    <a href="https://wa.me/971506309833" target="_blank">ðŸ“±</a>
    <a href="https://www.facebook.com/share/17HAzeWpsW/" target="_blank">ðŸ“˜</a>
    <a href="https://www.linkedin.com/in/bhola-nath-basak-3b6684242?trk=contact-info" target="_blank">ðŸ’¼</a>
  </footer>

  <script>
    let appointmentCounter = 1;
    let appointments = {};
    let loggedIn = false;

    function showSection(id) {
      document.querySelectorAll("section").forEach(sec => sec.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
    }

    // Visitor Form
    document.getElementById("visitorFormElement").addEventListener("submit", function(e){
      e.preventDefault();
      const appNo = "APP-" + appointmentCounter++;
      const visitor = {
        name: vName.value,
        email: vEmail.value,
        country: vCountry.value,
        code: vCountryCode.value,
        dob: vDob.value,
        date: vDate.value,
        time: vTime.value,
        status: "BUSY",
        chat: [],
        locked: false
      };
      appointments[appNo] = visitor;
      alert("Appointment Submitted! Your Appointment No: " + appNo);
      generatePrintLayout(appNo, visitor);
    });

    function generatePrintLayout(appNo, visitor) {
      const now = new Date();
      const printSection = document.getElementById("printSection");
      printSection.innerHTML = `
        <h2>E-Appointment Letter</h2>
        <p><strong>Appointment Number:</strong> ${appNo}</p>
        <p><strong>Generated Date:</strong> ${now.toLocaleString()}</p>
        <table>
          <tr><th>Name</th><td>${visitor.name}</td></tr>
          <tr><th>Email</th><td>${visitor.email}</td></tr>
          <tr><th>Country</th><td>${visitor.country} (+${visitor.code})</td></tr>
          <tr><th>Date of Birth</th><td>${visitor.dob}</td></tr>
          <tr><th>Visit Date</th><td>${visitor.date}</td></tr>
          <tr><th>Visit Time</th><td>${visitor.time}</td></tr>
          <tr><th>Visit To</th><td>BHOLA NATH BASAK</td></tr>
        </table>
        <button onclick="window.print()" class="btn btn-yellow">Print</button>
      `;
      printSection.style.display = "block";
    }

    // Admin Login
    document.getElementById("adminLoginForm").addEventListener("submit", function(e){
      e.preventDefault();
      if(adminUser.value === "admin" && adminPass.value === "password") {
        loggedIn = true;
        showSection("adminDashboard");
        loadVisitors();
      } else { alert("Invalid login!"); }
    });

    function logout() { loggedIn = false; showSection("adminLogin"); }

    function loadVisitors() {
      const container = document.getElementById("visitorList");
      container.innerHTML = "<h3>Visitor Appointments</h3>";
      for (let appNo in appointments) {
        const v = appointments[appNo];
        container.innerHTML += `
          <div style="border:1px solid #ccc; padding:10px; margin:10px;">
            <p><strong>${appNo}</strong> - ${v.name} (${v.email})</p>
            <button class="btn btn-green" onclick="updateStatus('${appNo}','ACCEPTED')">Accept</button>
            <button class="btn btn-red" onclick="updateStatus('${appNo}','REJECTED')">Reject</button>
            <button class="btn btn-grey" onclick="lockVisitor('${appNo}')" ${v.locked ? "disabled" : ""}>Lock Visitor</button>
            ${v.status === "ACCEPTED" && !v.locked ? renderChatBox(appNo,true) : ""}
          </div>
        `;
      }
    }

    function updateStatus(appNo, status) {
      appointments[appNo].status = status;
      loadVisitors();
    }

    function lockVisitor(appNo) {
      appointments[appNo].locked = true;
      alert(appNo + " has been locked.");
      loadVisitors();
    }

    function searchStatus() {
      const appNo = searchAppNo.value;
      const resultDiv = document.getElementById("visitorStatus");
      if(appointments[appNo]) {
        const v = appointments[appNo];
        let cls="", msg="";
        if(v.status === "ACCEPTED" && !v.locked) { cls="accepted"; msg="APPOINTMENT ACCEPTED"; }
        else if(v.status === "REJECTED") { cls="rejected"; msg="APPOINTMENT REJECTED"; }
        else if(v.locked) { cls="busy"; msg="VISITOR LOCKED"; }
        else { cls="busy"; msg="ADMIN BUSY"; }
        resultDiv.innerHTML = `<div class="status-box ${cls}">${msg}</div>`;
        if(v.status === "ACCEPTED" && !v.locked) {
          resultDiv.innerHTML += renderChatBox(appNo,false);
        }
      } else { resultDiv.innerHTML = "<p>No appointment found!</p>"; }
    }

    function renderChatBox(appNo,isAdmin) {
      const v = appointments[appNo];
      let chatHTML = `<div class="chat-box">
        <div class="chat-messages" id="chat-${appNo}">${v.chat.map(c=>`<p><strong>${c.from}:</strong> ${c.msg}</p>`).join("")}</div>
        <input class="chat-input" id="chatInput-${appNo}">
        <button onclick="sendMessage('${appNo}',${isAdmin})" class="btn btn-yellow">Send</button>
      </div>`;
      return chatHTML;
    }

    function sendMessage(appNo,isAdmin) {
      const input = document.getElementById("chatInput-"+appNo);
      const msg = input.value.trim();
      if(msg) {
        appointments[appNo].chat.push({from: isAdmin ? "Admin" : "Visitor", msg});
        input.value="";
        if(isAdmin) loadVisitors(); else searchStatus();
      }
    }
  </script>
</body>
</html>
