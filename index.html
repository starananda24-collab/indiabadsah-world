<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visitor Management System</title>
<style>
body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
header { background: #0b3d91; color: white; padding: 1rem; display: flex; align-items: center; }
header h1 { margin: 0; flex: 1; font-size: 1.5rem; }
.container { padding: 1rem; max-width: 1000px; margin: auto; }
form { background: white; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; }
form input, form select { width: 100%; padding: 0.5rem; margin: 0.5rem 0; }
button { padding: 0.5rem 1rem; margin-top: 1rem; cursor: pointer; }
table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; }
th, td { padding: 0.5rem; border-bottom: 1px solid #ccc; text-align: left; }
.status-pending { background: pink; color: black; font-weight: bold; }
.status-accepted { background: lightgreen; color: black; font-weight: bold; }
.status-rejected { background: red; color: white; font-weight: bold; }
</style>
</head>
<body>
<header>
  <h1>Visitor Management System</h1>
</header>
<div class="container">
  <h2>Visitor Form</h2>
  <form id="visitorForm">
    <input type="text" id="name" placeholder="Visitor Name" required>
    <input type="text" id="address" placeholder="Address" required>
    <input type="text" id="country" placeholder="Country" required>
    <input type="date" id="dob" placeholder="Date of Birth" required>
    <input type="date" id="date" placeholder="Visit Date" required>
    <input type="time" id="time" placeholder="Visit Time" required>
    <input type="text" id="contact" placeholder="Contact Number" required>
    <input type="text" id="purpose" placeholder="Purpose" required>
    <input type="email" id="email" placeholder="Email" required>
    <button type="submit">Submit</button>
  </form>

  <h2>Admin Dashboard</h2>
  <table id="adminTable">
    <thead>
      <tr>
        <th>Appointment No</th>
        <th>Name</th>
        <th>Address</th>
        <th>Country</th>
        <th>DOB</th>
        <th>Date</th>
        <th>Time</th>
        <th>Contact</th>
        <th>Purpose</th>
        <th>Email</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyU-aycefMRE9htioaZ5RrTFMus7n89PNl6NiXwRmeSuitwiePk0qxsuCQkwLKKTI6i/exec";

const visitorForm = document.getElementById("visitorForm");
const adminTableBody = document.querySelector("#adminTable tbody");

// Submit visitor form
visitorForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = {
    name: document.getElementById("name").value,
    address: document.getElementById("address").value,
    country: document.getElementById("country").value,
    dob: document.getElementById("dob").value,
    date: document.getElementById("date").value,
    time: document.getElementById("time").value,
    contact: document.getElementById("contact").value,
    purpose: document.getElementById("purpose").value,
    email: document.getElementById("email").value
  };
  try {
    const res = await fetch(WEB_APP_URL, {
      method: "POST",
      body: JSON.stringify(formData),
      headers: { "Content-Type": "application/json" }
    });
    const data = await res.json();
    if(data.success) {
      alert("Form submitted! Appointment No: " + data.appointmentNo);
      visitorForm.reset();
      loadAdminData();
    } else {
      alert("Error: " + data.error);
    }
  } catch(err) {
    alert("Failed to submit: " + err.message);
  }
});

// Load admin table
async function loadAdminData() {
  try {
    const res = await fetch(WEB_APP_URL + "?action=all");
    const data = await res.json();
    if(data.success) {
      adminTableBody.innerHTML = "";
      data.data.forEach(record => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${record['Appointment No']}</td>
          <td>${record['Name']}</td>
          <td>${record['Address']}</td>
          <td>${record['Country']}</td>
          <td>${record['DOB']}</td>
          <td>${record['Date']}</td>
          <td>${record['Time']}</td>
          <td>${record['Contact']}</td>
          <td>${record['Purpose']}</td>
          <td>${record['Email']}</td>
          <td class="${record['Status'] === 'Pending' ? 'status-pending' : record['Status'] === 'Accepted' ? 'status-accepted' : 'status-rejected'}">${record['Status']}</td>
          <td>
            <button onclick="updateStatus('${record['Appointment No']}', 'Accepted')">Accept</button>
            <button onclick="updateStatus('${record['Appointment No']}', 'Rejected')">Reject</button>
            <button onclick="updateStatus('${record['Appointment No']}', 'Pending')">Pending</button>
          </td>
        `;
        adminTableBody.appendChild(tr);
      });
    }
  } catch(err) {
    console.error("Failed to load admin data:", err);
  }
}

// Update status
async function updateStatus(appointmentNo, status) {
  try {
    const res = await fetch(WEB_APP_URL, {
      method: "POST",
      body: JSON.stringify({ appointmentNo, status }),
      headers: { "Content-Type": "application/json" }
    });
    const data = await res.json();
    if(data.success) {
      alert("Status updated!");
      loadAdminData();
    } else {
      alert("Error updating status: " + data.error);
    }
  } catch(err) {
    alert("Failed to update status: " + err.message);
  }
}

// Initial load
loadAdminData();
</script>
</body>
</html>
